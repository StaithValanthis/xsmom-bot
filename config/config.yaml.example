# =========================
# XSMOM-BOT — CONFIG (COMPATIBLE)
# =========================

paths:
  state_path: /opt/xsmom-bot/state/state.json
  logs_dir: /opt/xsmom-bot/logs
  metrics_path: /opt/xsmom-bot/metrics/metrics.prom

exchange:
  id: bybit
  account_type: swap
  quote: USDT
  only_perps: true
  unified_margin: true
  testnet: false
  timeframe: "1h"
  candles_limit: 1500

liquidity:
  max_symbols: 50
  min_usd_volume_24h: 30000000
  min_price: 0.03

execution:
  maker_first: true
  maker_ttl_secs: 10
  taker_on_strong_signal: true
  strong_signal_band: 0.90      # allow taker if |z| >= strong band
  max_spread_bps: 8             # skip if spread wider than this
  max_slippage_bps: 12          # skip if implied slippage worse than this
  pyramiding:
    enabled: true            # default: do NOT add to an existing position
    allow_when_rr_ge: 1.0     # optional: only add if locked/trailing R ≥ this (used if enabled)

costs:
  taker_bps: 5
  maker_bps: 1
  slippage_bps: 2

strategy:
  # === Momentum / signals ===
  lookbacks: [1, 6, 24]
  lookback_weights: [1.0, 1.5, 2.0]
  z_power: 1.35
  market_neutral: true
  carry:
    enabled: true

    # How much of portfolio gross to reserve for the carry sleeve (rest for momentum)
    budget_frac: 0.35        # 35% to carry, 65% to momentum

    # Global sleeve caps (applied on top of your main caps)
    per_symbol_notional_cap_pct: 0.20   # ≤20% of equity per carry pair
    max_weight_per_asset: 0.12          # hard weight cap within the carry sleeve
    gross_leverage: 0.90                # intra-sleeve gross; combined book still obeys main gross

    # If your ExchangeWrapper supports only perps, the sleeve falls back to a *small* directional tilt
    # instead of true delta-neutral pairs.
    allow_directional_fallback: true
    fallback_weight_scale: 0.35         # scale on directional tilt (keeps it small & safe)

    funding:
      enabled: true
      intervals_for_mean: 6             # use last 6 intervals (e.g., 8h funding → 2 days)
      min_entry_apy: 0.15               # 15% APY hurdle (net, ex-fees/borrow assumptions)
      min_exit_apy: 0.08                # 8% APY exit
      min_percentile_30d: 0.80          # only enter if funding is in top 20% of last 30d
      sign_stability_k: 5               # ≥5 of last 6 intervals have same sign
      spread_gate_bps: 10               # skip if spreads wider than 10 bps
      depth_usd_min: 2000               # skip if insufficient depth at top of book
      hedge_preference: ["spot", "dated_future", "perp_proxy"]

    basis:
      enabled: true
      min_entry_apy: 0.15               # 15% APY net basis to enter
      min_exit_apy: 0.08                # 8% APY to keep/exit
      roll_threshold_days: 5            # roll if DTE < 5d
      dte_min_days: 10                  # prefer contracts with ≥10d remaining
      spread_gate_bps: 10
      depth_usd_min: 3000
      hedge_preference: ["spot", "perp"]  # if spot unavailable, hedge with perp (basis vs perp)  

  # === No-trade bands (hysteresis) ===
  no_trade_bands:
    enabled: true
    z_entry: 0.65
    z_exit: 0.45

  # === Selection: Dynamic K ===
  selection:
    dynamic_k:
      enabled: true
      k_min: 2
      k_max: 8
      kappa: 5.0
      fallback_k: 6

  # === Sizing / caps ===
  gross_leverage: 1.20
  max_weight_per_asset: 0.14          # hard per-asset weight cap
  per_symbol_notional_cap_pct: 0.20   # |notional_i| <= 20% of equity

  # === Portfolio Volatility Target Scaling ===
  portfolio_vol_target:
    enabled: true
    target_ann_vol: 0.35              # 35% annualized portfolio vol
    lookback_hours: 72
    min_scale: 0.50
    max_scale: 1.60

  # === ADX/DI filter ===
  adx_filter:
    enabled: true
    len: 14
    min_adx: 25
    require_rising: true
    use_di_alignment: true

risk:
  kill_switch:
    daily_loss_pct: 6.0
    resume_after_minutes: 180

logging:
  level: INFO
  to_file: true
  file: /opt/xsmom-bot/logs/live.log
